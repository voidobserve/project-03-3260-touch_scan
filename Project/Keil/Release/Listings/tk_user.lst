C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TK_USER
OBJECT MODULE PLACED IN .\Release\Objects\tk_user.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\tk_user.c LARGE OPTIMIZE(8,SIZE) BROWSE INTVECTOR(0X000C) INC
                    -DIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Lis
                    -tings\tk_user.lst) OBJECT(.\Release\Objects\tk_user.obj)

line level    source

   1          /**
   2           ******************************************************************************
   3           * @file    User/tk_user.c
   4           * @author  HUGE-IC Application Team
   5           * @version V1.0.0
   6           * @date    05-20-2022
   7           * @brief   Main program body
   8           ******************************************************************************
   9           * @attention
  10           *
  11           * <h2><center>&copy; COPYRIGHT 2022 TAIXIN-IC</center></h2>
  12           *
  13           *
  14           *
  15           ******************************************************************************
  16           */
  17          
  18          /* Includes ------------------------------------------------------------------*/
  19          #include "include.h"
  20          #include "my_config.h"
  21          
  22          // /**
  23          //  * @brief  ç”¨æˆ·ä»£ç åˆå§‹åŒ–å‡½æ•°æ¥å£.
  24          //  * @param  None
  25          //  * @retval None
  26          //  */
  27          // void user_init(void)
  28          // {
  29          //     fun_info_init(); // åˆå§‹åŒ–ç”¨äºå­˜æ”¾ä¿¡æ¯çš„å˜é‡
  30          
  31          //     tmr0_config();           // ä¸²å£æ£€æµ‹æ•°æ®è¶…æ—¶éœ€è¦ä½¿ç”¨åˆ°çš„å®šæ—¶å™¨
  32          //     uart0_config();          // å‘é€å’Œæ¥æ”¶æŒ‡ä»¤ä½¿ç”¨åˆ°çš„ä¸²å£
  33          //     pin_level_scan_config(); // åˆ¹è½¦ã€è½¬å‘ç¯ã€æŒ¡ä½çš„æ£€æµ‹å¼•è„šé…ç½®
  34          
  35          //     tmr1_config(); // æ£€æµ‹ä¸€æ®µæ—¶é—´å†…çš„è„‰å†²ä¸ªæ•°æ‰€éœ€çš„å®šæ—¶å™¨
  36          //     // tmr2_pwm_config(); // æµ‹è¯•ç”¨çš„PWM
  37          //     speed_scan_config();        // æ—¶é€Ÿæ‰«æçš„é…ç½®
  38          //     engine_speed_scan_config(); // å‘åŠ¨æœºè½¬é€Ÿæ‰«æçš„é…ç½®
  39          
  40          //     tmr3_config(); // å®šæ—¶å°†é‡Œç¨‹å†™å…¥flashæ‰€éœ€çš„å®šæ—¶å™¨
  41          
  42          //     // mileage_init(); // ä»flashä¸­è¯»å‡ºå¤§è®¡é‡Œç¨‹å’Œå°è®¡é‡Œç¨‹æ•°æ®ï¼ˆå·²ç»å¹¶å…¥fun_infoç»“æ
             -„ä½“å˜é‡ä¸­ï¼‰
  43          
  44          //     // p03_output_config(); // è¾“å‡ºé«˜ç”µå¹³ç”¨çš„å¼•è„šï¼Œåˆ°æ—¶å€™æ£€æµ‹adåˆ°äº†ä¸€å®šå€¼ï¼Œå†è®©å
             -®ƒè¾“å‡ºé«˜ç”µå¹³ï¼Œç°åœ¨å®ƒä¸€å¼€å§‹å°±æ˜¯é«˜ç”µå¹³
  45          //     // P03 = 1;
  46          
  47          //     adc_pin_config();
  48          // }
  49          
  50          /**
  51           * @brief __is_double_click() åˆ¤æ–­æ˜¯å¦æœ‰åŒå‡»åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®,å†…éƒ¨æœ€é•¿å»¶æ—¶æ—¶é—´ï¼šDETECT
C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 2   

             -_DOUBLE_CLICK_INTERVAL
  52           *
  53           * @param touch_key_id_const
  54           * @return u8 0--æ²¡æœ‰åŒå‡»åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®ï¼Œ1--åŒå‡»äº†åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®
  55           */
  56          // u8 __is_double_click(const u32 touch_key_id_const)
  57          // {
  58          //     u8 i = 0;                   // å¾ªç¯è®¡æ•°å€¼
  59          //     volatile u32 touch_key = 0; // å­˜æ”¾æ¯æ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®
  60          
  61          //     for (; i < DETECT_DOUBLE_CLICK_INTERVAL; i++)
  62          //     {
  63          //         delay_ms(1);
  64          //         __tk_scan();
  65          //         touch_key = __tk_key_flag;
  66          
  67          //         if (touch_key_id_const == touch_key)
  68          //         {
  69          //             // å¦‚æœæ£€æµ‹åˆ°æ˜¯åŒä¸€ä¸ªæŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜æ˜¯åŒå‡»
  70          //             return 1; // åŒå‡»äº†åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®ï¼Œè¿”å›1
  71          //         }
  72          //     }
  73          
  74          //     return 0; // æ²¡æœ‰åŒå‡»åŒä¸€ä¸ªè§¦æ‘¸æŒ‰é”®ï¼Œè¿”å›0
  75          // }
  76          
  77          enum
  78          {
  79              TOUCH_KEY_SCAN_STATUS_NONE,                  // ç©ºçŠ¶æ€ï¼Œæ£€æµ‹æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹
  80              TOUCH_KEY_SCAN_STATUS_IS_DETECT_LOOG_PRESS,  // æ­£åœ¨æ£€æµ‹æ˜¯å¦ä¸ºé•¿æŒ‰ï¼ˆè¦è·Ÿæ£€æµ‹é•¿æŒ‰ä½œåŒº
             -åˆ†ï¼‰
  81              TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰
  82              TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS,  // æ­£åœ¨å¤„ç†é•¿æŒ‰æŒç»­ï¼ˆä¸æ¾æ‰‹ï¼‰
  83              TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS, // æ­£åœ¨å¤„ç†çŸ­æŒ‰
  84          
  85              TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE, // æ­£åœ¨ç­‰å¾…çŸ­æŒ‰æ¾å¼€
  86              TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE,  // æ­£åœ¨ç­‰å¾…é•¿æŒ‰æ¾å¼€
  87              TOUCH_KEY_SCAN_STATUS_IS_END,                      // æ”¶å°¾å¤„ç†
  88          };
  89          
  90          static volatile u8 touch_key_scan_status = 0; // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°ä¸­ï¼Œä½¿ç”¨çš„çŠ¶æ€æœº
  91          
  92          // éé˜»å¡çš„æŒ‰é”®æ‰«æå‡½æ•°
  93          void touch_key_scan(void)
  94          {
  95   1          volatile u32 touch_key = 0;             // __tk_key_flag å•æ¬¡æŒ‰é”®æ ‡å¿—
  96   1          static u32 touch_key_last = 0;          // ç”¨äºå­˜æ”¾é•¿æŒ‰æ—¶ï¼Œå¯¹åº”çš„æŒ‰é”®
  97   1          static volatile u32 touch_time_cnt = 0; // é•¿æŒ‰è®¡æ•°å€¼
  98   1      
  99   1          /* æŒ‰é”®æ‰«æå‡½æ•° */
 100   1          __tk_scan();               // ä½¿ç”¨äº†åº“é‡Œé¢çš„æ¥å£ï¼ˆé—­æºåº“ï¼‰
 101   1          touch_key = __tk_key_flag; // __tk_key_flag å•æ¬¡æŒ‰é”®æ ‡å¿—
 102   1      
 103   1          if (TOUCH_KEY_SCAN_STATUS_NONE == touch_key_scan_status) // æœªæ£€æµ‹åˆ°æŒ‰é”®æ—¶
 104   1          {
 105   2              // å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆå¹¶ä¸”ä¹‹å‰æ‰«æåˆ°çš„ä¸æ˜¯é•¿æŒ‰ï¼‰
 106   2              // åˆ¤æ–­æ˜¯å¦ä¸ºé•¿æŒ‰ï¼š
 107   2              if (touch_key_last == 0) // å¦‚æœä¹‹å‰æœªæ£€æµ‹åˆ°æŒ‰é”®
 108   2              {
 109   3                  touch_key_last = touch_key;
 110   3              }
 111   2              else if (touch_key_last == touch_key)
C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 3   

 112   2              {
 113   3                  // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ç›¸ç­‰ï¼Œè¯´æ˜æŒ‰é”®è¿˜æœªæ¾å¼€
 114   3                  touch_time_cnt += (1 + ONE_CYCLE_TIME_MS);
 115   3      
 116   3                  if (touch_time_cnt >= LONG_PRESS_TIME_THRESHOLD_MS)
 117   3                  {
 118   4                      // å¦‚æœé•¿æŒ‰è¶…è¿‡äº†è®¾ç½®çš„é•¿æŒ‰æ—¶é—´
 119   4                      // è·³è½¬åˆ°é•¿æŒ‰å¤„ç†
 120   4                      touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°
 121   4                      // printf("long press\n"); // æµ‹è¯•ç”¨
 122   4                      touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS;
 123   4                  }
 124   3              }
 125   2              else
 126   2              {
 127   3                  // å¦‚æœä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸æ­¤æ¬¡çš„æŒ‰é”®ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”ä¸Šæ¬¡æ£€æµ‹åˆ°çš„æŒ‰é”®ä
             -¸ç­‰äº0
 128   3                  // touch_time_cnt = 0; // æ¸…é™¤é•¿æŒ‰æ—¶é—´è®¡æ•°ï¼ˆå¯ä»¥ç•™åˆ°æ”¶å°¾å¤„ç†ï¼‰
 129   3      
 130   3                  // è·³è½¬åˆ°çŸ­æŒ‰å¤„ç†
 131   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS;
 132   3                  // printf("short press\n"); // æµ‹è¯•ç”¨
 133   3              }
 134   2      
 135   2              delay_ms(1); //
 136   2          }
 137   1      
 138   1          if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_SHORT_PRESS == touch_key_scan_status)
 139   1          {
 140   2              // å¦‚æœæ˜¯æ­£åœ¨å¤„ç†çŸ­æŒ‰
 141   2      
 142   2              if (TOUCH_KEY_ONE_LEFT == touch_key_last)
 143   2              {
 144   3                  // å¦‚æœ å·¦ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸€ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 145   3      #if USE_MY_DEBUG
 146   3                  printf("1 left press\n");
 147   3      #endif
 148   3                  // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY1); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
 149   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
 150   3              }
 151   2              else if (TOUCH_KEY_TWO_LEFT == touch_key_last)
 152   2              {
 153   3                  // å¦‚æœ å·¦ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬äºŒä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 154   3      
 155   3      #if USE_MY_DEBUG
 156   3                  printf("2 left press\n");
 157   3      #endif
 158   3                  // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY2); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
 159   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
 160   3              }
 161   2              else if (TOUCH_KEY_THREE_LEFT == touch_key_last)
 162   2              {
 163   3                  // å¦‚æœ å·¦ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸‰ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 164   3      
 165   3      #if USE_MY_DEBUG
 166   3                  printf("3 left press\n");
 167   3      #endif
 168   3                  // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY3); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
 169   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 4   

 170   3              }
 171   2              else if (TOUCH_KEY_ONE_RIGHT == touch_key_last)
 172   2              {
 173   3                  // å¦‚æœ å³ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸€ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 174   3      
 175   3      #if USE_MY_DEBUG
 176   3                  printf("1 right press\n");
 177   3      #endif
 178   3                  // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY4); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
 179   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
 180   3              }
 181   2              else if (TOUCH_KEY_TWO_RIGHT == touch_key_last)
 182   2              {
 183   3                  // å¦‚æœ å³ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬äºŒä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 184   3      
 185   3      #if USE_MY_DEBUG
 186   3                  printf("2 right press\n");
 187   3      #endif
 188   3                  // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY5); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
 189   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
 190   3              }
 191   2              else if (TOUCH_KEY_THREE_RIGHT == touch_key_last)
 192   2              {
 193   3                  // å¦‚æœ å³ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸‰ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 194   3      
 195   3      #if USE_MY_DEBUG
 196   3                  printf("3 right press\n");
 197   3      #endif
 198   3                  // send_status_keyval(KEY_PRESS_SHORT, TOUCH_KEY5); // å‘é€å¸¦æœ‰çŠ¶æ€çš„é”®å€¼
 199   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE; // ç­‰å¾…æŒ‰é”®æ¾å
             -¼€
 200   3              }
 201   2          }
 202   1      
 203   1          if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_LONG_PRESS == touch_key_scan_status)
 204   1          {
 205   2              // å¤„ç†é•¿æŒ‰
 206   2              if (TOUCH_KEY_ONE_LEFT == touch_key)
 207   2              {
 208   3                  // å¦‚æœ å·¦ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸€ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 209   3      
 210   3      #if USE_MY_DEBUG
 211   3                  printf("1 left long press\n");
 212   3      #endif
 213   3                  // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY1);
 214   3              }
 215   2              else if (TOUCH_KEY_TWO_LEFT == touch_key)
 216   2              {
 217   3                  // å¦‚æœ å·¦ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬äºŒä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 218   3      
 219   3      #if USE_MY_DEBUG
 220   3                  printf("2 left long press\n");
 221   3      #endif
 222   3                  // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY2);
 223   3              }
 224   2              else if (TOUCH_KEY_THREE_LEFT == touch_key)
 225   2              {
 226   3                  // å¦‚æœ å·¦ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸‰ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 227   3      
 228   3      #if USE_MY_DEBUG
C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 5   

 229   3                  printf("3 left long press\n");
 230   3      #endif
 231   3                  // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY3);
 232   3              }
 233   2              else if (TOUCH_KEY_ONE_RIGHT == touch_key)
 234   2              {
 235   3                  // å¦‚æœ å³ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸€ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 236   3      
 237   3      #if USE_MY_DEBUG
 238   3                  printf("1 right long press\n");
 239   3      #endif
 240   3                  // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY4);
 241   3              }
 242   2              else if (TOUCH_KEY_TWO_RIGHT == touch_key)
 243   2              {
 244   3                  // å¦‚æœ å³ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬äºŒä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 245   3      
 246   3      #if USE_MY_DEBUG
 247   3                  printf("2 right long press\n");
 248   3      #endif
 249   3                  // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY5);
 250   3              }
 251   2              else if (TOUCH_KEY_THREE_RIGHT == touch_key)
 252   2              {
 253   3                  // å¦‚æœ å³ä¾§æ•°ä¸‹æ¥ï¼Œç¬¬ä¸‰ä¸ªè§¦æ‘¸æŒ‰é”® è¢«è§¦æ‘¸
 254   3      
 255   3      #if USE_MY_DEBUG
 256   3                  printf("3 right long press\n");
 257   3      #endif
 258   3                  // send_status_keyval(KEY_PRESS_LONG, TOUCH_KEY5);
 259   3              }
 260   2      
 261   2              touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS; // è·³è½¬åˆ°é•¿æŒ‰æŒç»­
 262   2          }
 263   1      
 264   1          if (TOUCH_KEY_SCAN_STATUS_IS_HANDLE_HOLD_PRESS == touch_key_scan_status)
 265   1          {
 266   2              // å¤„ç†é•¿æŒ‰æŒç»­
 267   2      
 268   2              if (touch_key_last == touch_key)
 269   2              {
 270   3                  touch_time_cnt++;
 271   3                  if (TOUCH_KEY_ONE_LEFT == touch_key)
 272   3                  {
 273   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 274   4                      {
 275   5                          touch_time_cnt = 0;
 276   5      #if USE_MY_DEBUG
 277   5                          printf("1 left continue press\n");
 278   5      #endif
 279   5                          // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY1);
 280   5                      }
 281   4                  }
 282   3                  else if (TOUCH_KEY_TWO_LEFT == touch_key)
 283   3                  {
 284   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 285   4                      {
 286   5                          touch_time_cnt = 0;
 287   5      #if USE_MY_DEBUG
 288   5                          printf("2 left continue press\n");
 289   5      #endif
 290   5                          // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY2);
C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 6   

 291   5                      }
 292   4                  }
 293   3                  else if (TOUCH_KEY_THREE_LEFT == touch_key)
 294   3                  {
 295   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 296   4                      {
 297   5                          touch_time_cnt = 0;
 298   5      #if USE_MY_DEBUG
 299   5                          printf("3 left continue press\n");
 300   5      #endif
 301   5                          // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY3);
 302   5                      }
 303   4                  }
 304   3                  else if (TOUCH_KEY_ONE_RIGHT == touch_key)
 305   3                  {
 306   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 307   4                      {
 308   5                          touch_time_cnt = 0;
 309   5      #if USE_MY_DEBUG
 310   5                          printf("1 right continue press\n");
 311   5      #endif
 312   5                          // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY4);
 313   5                      }
 314   4                  }
 315   3                  else if (TOUCH_KEY_TWO_RIGHT == touch_key)
 316   3                  {
 317   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 318   4                      {
 319   5                          touch_time_cnt = 0;
 320   5      #if USE_MY_DEBUG
 321   5                          printf("2 right continue press\n");
 322   5      #endif
 323   5                          // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY5);
 324   5                      }
 325   4                  }
 326   3                  else if (TOUCH_KEY_THREE_RIGHT == touch_key)
 327   3                  {
 328   4                      if (touch_time_cnt >= HOLD_PRESS_TIME_THRESHOLD_MS)
 329   4                      {
 330   5                          touch_time_cnt = 0;
 331   5      #if USE_MY_DEBUG
 332   5                          printf("3 right continue press\n");
 333   5      #endif
 334   5                          // send_status_keyval(KEY_PRESS_CONTINUE, TOUCH_KEY5);
 335   5                      }
 336   4                  }
 337   3      
 338   3                  delay_ms(1);
 339   3              }
 340   2              else
 341   2              {
 342   3                  // å¦‚æœä¹‹å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸å½“å‰æ£€æµ‹åˆ°çš„æŒ‰é”®ä¸ä¸€è‡´ï¼Œ
 343   3                  // è¯´æ˜ å¯èƒ½æ¾å¼€äº†æ‰‹ æˆ–æ˜¯ ä¸€åªæ‰‹æŒ‰ä½äº†åŸæ¥çš„æŒ‰é”®å¦ä¸€åªæ‰‹æŒ‰äº†å…¶ä»–æ
             -Œ‰é”®
 344   3      
 345   3                  // è·³è½¬åˆ°ç­‰å¾…é•¿æŒ‰æ¾å¼€
 346   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE;
 347   3              }
 348   2          }
 349   1      
 350   1          if ((TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == touch_key_scan_status) ||
 351   1              (TOUCH_KEY_SCAN_STATUS_IS_WAIT_SHORT_PRESS_RELEASE == touch_key_scan_status))
C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 7   

 352   1          {
 353   2              // å¦‚æœæ˜¯ç­‰å¾…æŒ‰é”®æ¾å¼€
 354   2              static volatile u16 loose_cnt = 0; // å­˜æ”¾æ¾æ‰‹è®¡æ•°å€¼
 355   2      
 356   2              if (touch_key == 0)
 357   2              {
 358   3                  loose_cnt++;
 359   3                  delay_ms(1);
 360   3              }
 361   2              else
 362   2              {
 363   3                  // åªè¦æœ‰ä¸€æ¬¡æ£€æµ‹åˆ°æŒ‰é”®ï¼Œè¯´æ˜æ²¡æœ‰æ¾å¼€æ‰‹
 364   3                  loose_cnt = 0;
 365   3              }
 366   2      
 367   2              if (loose_cnt >= LOOSE_PRESS_CNT_MS) // è¿™é‡Œçš„æ¯”è¾ƒå€¼éœ€è¦æ³¨æ„ï¼Œä¸èƒ½å¤§äºå˜é‡ç±»å‹å
             -¯¹åº”çš„æœ€å¤§å€¼
 368   2              {
 369   3                  loose_cnt = 0; // æ¸…ç©ºæ¾æ‰‹è®¡æ•°
 370   3                  // å¦‚æœ xx mså†…æ²¡æœ‰æ£€æµ‹åˆ°æŒ‰é”®æŒ‰ä¸‹ï¼Œè¯´æ˜å·²ç»æ¾å¼€æ‰‹
 371   3      
 372   3      //             if (TOUCH_KEY_SCAN_STATUS_IS_WAIT_LONG_PRESS_RELEASE == touch_key_scan_status)
 373   3      //             {
 374   3      //                 if (TOUCH_KEY_ID_1 == touch_key_last)
 375   3      //                 {
 376   3      // #if USE_MY_DEBUG
 377   3      //                     printf("k1 long press loose\n");
 378   3      // #endif
 379   3      //                     // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY1);
 380   3      //                 }
 381   3      //                 else if (TOUCH_KEY_ID_2 == touch_key_last)
 382   3      //                 {
 383   3      // #if USE_MY_DEBUG
 384   3      //                     printf("k2 long press loose\n");
 385   3      // #endif
 386   3      //                     // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY2);
 387   3      //                 }
 388   3      //                 else if (TOUCH_KEY_ID_3 == touch_key_last)
 389   3      //                 {
 390   3      // #if USE_MY_DEBUG
 391   3      //                     printf("k3 long press loose\n");
 392   3      // #endif
 393   3      //                     // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY3);
 394   3      //                 }
 395   3      //                 else if (TOUCH_KEY_ID_4 == touch_key_last)
 396   3      //                 {
 397   3      // #if USE_MY_DEBUG
 398   3      //                     printf("k4 long press loose\n");
 399   3      // #endif
 400   3      //                     // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY4);
 401   3      //                 }
 402   3      //                 else if (TOUCH_KEY_ID_5 == touch_key_last)
 403   3      //                 {
 404   3      // #if USE_MY_DEBUG
 405   3      //                     printf("k5 long press loose\n");
 406   3      // #endif
 407   3      //                     // send_status_keyval(KEY_PRESS_LOOSE, TOUCH_KEY5);
 408   3      //                 }
 409   3      //             }
 410   3      
 411   3                  touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_IS_END; // è·³è½¬åˆ°æ”¶å°¾å¤„ç†
 412   3              }
C51 COMPILER V9.60.7.0   TK_USER                                                           11/20/2024 17:46:09 PAGE 8   

 413   2          }
 414   1      
 415   1          if (TOUCH_KEY_SCAN_STATUS_IS_END == touch_key_scan_status)
 416   1          {
 417   2              // æ”¶å°¾å¤„ç†
 418   2              touch_key = 0;
 419   2              touch_key_last = 0;
 420   2              touch_time_cnt = 0;
 421   2      
 422   2              touch_key_scan_status = TOUCH_KEY_SCAN_STATUS_NONE;
 423   2          }
 424   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1033    ----
   CONSTANT SIZE    =    345    ----
   XDATA SIZE       =     11       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
